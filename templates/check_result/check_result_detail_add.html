{% extends "check_result/check_result_layout.html" %}
{% block header_describe %}{% endblock %}
{% block media %}
<link href="{{ MEDIA_URL }}css/auto_complete/jquery.autocomplete.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-ui-1.8.6.custom.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.autocomplete.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/file_upload/ajaxupload.js"></script>
<script type="text/javascript">
$(document).ready(function(){
                $.getJSON("{% url service_area_name_ajax %}",
                          {
                          },
                          function(data) {
                                  $("#id_service_area_name").autocomplete(data, {
                                          minChars: 0,
                                                          max: 12,
//                                                          autoFill: true,
//                                                          mustMatch: true,
                                                          matchContains: true,
                                                          scrollHeight: 220,
                                                          formatItem: function(data, i, total) {
                                                          // don't show the current month in the list of values (for whatever reason)
                                                          //if ( data[0] == months[new Date().getMonth()] ) 
                                                          //return false;
                                                          return data[0];
                                                  }
                                          });
                                  $("#id_mate_service_area_name").autocomplete(data, {
                                          minChars: 0,
                                                          max: 12,
//                                                          autoFill: true,
//                                                          mustMatch: true,
                                                          matchContains: true,
                                                          scrollHeight: 220,
                                                          formatItem: function(data, i, total) {
                                                          // don't show the current month in the list of values (for whatever reason)
                                                          //if ( data[0] == months[new Date().getMonth()] ) 
                                                          //return false;
                                                          return data[0];
                                                  }
                                          });

                          });
                $("#id_service_area_name").blur(function() {
                                service_area_name_old = '';
                                service_area_name = $("#id_service_area_name").val();
                                if (service_area_name != '' && service_area_name != service_area_name_old)
                                {
//                                        alert('********');
                                        service_area_name_old = service_area_name;
                                        $("#id_department_name").unautocomplete();
                                        $.getJSON("{% url department_name_ajax %}",
                                                  {
                                                  service_area_name :$("#id_service_area_name").val()
                                                                  },
                                                  function(data) {
                                                          $("#id_department_name").autocomplete(data, {
                                                                  minChars: 0,
                                                                                  max: 12,
//                                                          autoFill: true,
//                                                          mustMatch: true,
                                                                                  matchContains: true,
                                                                                  scrollHeight: 220,
                                                                                  formatItem: function(data, i, total) {
                                                                                  // don't show the current month in the list of values (for whatever reason)
                                                                                  //if ( data[0] == months[new Date().getMonth()] ) 
                                                                                  //return false;
                                                                                  return data[0];
                                                                          }
                                                                  });

                                                  });

                                }
                                
                        });
                $("#id_mate_service_area_name").blur(function() {
                                mate_service_area_name_old = '';
                                mate_service_area_name = $("#id_mate_service_area_name").val();
                                if (mate_service_area_name != '' && mate_service_area_name != mate_service_area_name_old)
                                {
//                                        alert('********');
                                        mate_service_area_name_old = mate_service_area_name;
                                        $("#id_mate_department_name").unautocomplete();
                                        $.getJSON("{% url department_name_ajax %}",
                                                  {
                                                  service_area_name :$("#id_mate_service_area_name").val()
                                                                  },
                                                  function(data) {
                                                          $("#id_mate_department_name").autocomplete(data, {
                                                                  minChars: 0,
                                                                                  max: 12,
//                                                          autoFill: true,
//                                                          mustMatch: true,
                                                                                  matchContains: true,
                                                                                  scrollHeight: 220,
                                                                                  formatItem: function(data, i, total) {
                                                                                  // don't show the current month in the list of values (for whatever reason)
                                                                                  //if ( data[0] == months[new Date().getMonth()] ) 
                                                                                  //return false;
                                                                                  return data[0];
                                                                          }
                                                                  });

                                                  });

                                }
                                
                        });

        });
</script>
{% endblock %}

{% block teaser %}
{% load cache %}
{% cache 500 check_result_detail_add user.username %}
<div class="nav_hlist">
<ul>
  {% if perms.department.cr_add %}
  <li class="active"><strong>检查结果录入</strong></li>
  <li><a href="{% url check_result_add 1 %}">检查结果添加</a></li>
  {% endif %}
  {% if perms.department.cr_list %}
  <li><a href="{% url check_result_list 1 %}">检查结果查询</a></li>
  {% endif %}
</ul>
</div>
{% endcache %}
{% endblock %}
{% block main %}
<div class="subcolumns">
  <div class="c75l">
    <div class="subc">
      <!-- Insert your subtemplate content here -->
      {% if result %}
      <div class="note">
        <div class="subcolumns">
          <div class="c60l">
            <div class="subc">
              <table border="0" cellpadding="0" cellspacing="0" class="full">
                <caption>
                  检查对象
                </caption>
                <thead>
                  <tr><th scope="col" colspan="2">{{ result.name }} | {{ result.id_number }}</th></tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row" class="sub">妻子姓名<hr>身份证号</th>
                    <td>{{ result.name }}<hr>{{ result.id_number }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="sub">服务区域<hr>单位部门</th>
                    <td>{{ result.service_area_department.service_area.name }}<hr>{{ result.service_area_department.department.name }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="sub">家属<hr>结婚时间</th>
                    {% if result.is_family %} 
                    <td>是<hr>{{ result.wedding_time|date:"Y-m-d" }}</td>
                    {% else %}
                    <td>否<hr>{{ result.wedding_time|date:"Y-m-d" }}</td>
                    {% endif %}
                  </tr>
                  <tr>
                    <th scope="row" class="sub">丈夫姓名<hr>身份证号</th>
                    <td>{{ result.mate_name }}<hr>{{ result.mate_id_number }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="sub">服务区域<hr>单位部门</th>
                    <td>{{ result.mate_service_area_department.service_area.name }}<hr>{{ result.mate_service_area_department.department.name }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="sub">避孕方式<hr>实施时间</th>
                    {% if result.ctp_method == '0' %}
                    <td>未使用<hr>{{ result.ctp_method_time|date:"Y-m-d" }}</td>
                    {% endif %}
                    {% if result.ctp_method == '1' %}
                    <td>避孕环方式<hr>{{ result.ctp_method_time|date:"Y-m-d" }}</td>
                    {% endif %}
                    {% if result.ctp_method == '2' %}
                    <td>避孕药方式<hr>{{ result.ctp_method_time|date:"Y-m-d" }}</td>
                    {% endif %}
                    {% if result.ctp_method == '3' %}
                    <td>其他方式<hr>{{ result.ctp_method_time|date:"Y-m-d" }}</td>
                    {% endif %}
                  </tr>
                  <tr>
                    <th scope="row" class="sub">创建人员</th>
                    <td>{{ result.creater.username }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="sub">创建时间</th>
                    <td>{{ result.created_at|date:"Y-m-d H:i:s" }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="sub">更新时间</th>
                    <td>{{ result.updated_at|date:"Y-m-d H:i:s" }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="c40r">
            <div class="subc important">
              <div class="center">
                <hr>
                <img src="{{ result.photo.url }}"/>
                <p>{{ result.name }}的照片</p>
                <p>{{ result.id_number }}</p>          
                <hr>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% else %}
      <p class="warning">对不起，该检查对象不存在！</p>
      {% endif %}
      
    </div>          
  </div>         
  <div class="c25r">
    <div class="subc important">
      <!-- Insert your subtemplate content here -->
      {% with detail_add_form as form %}
      <form method="get" action="{% url check_result_detail_add %}" class="yform full" id="id_form_detail_add">{% csrf_token %}
        <div class="">
          <fieldset>
            <legend>检查结果信息</legend>
            {% if form.pregnant.errors %}
            <div class="type-select error">
              <strong class="message">{{ form.pregnant.errors }}</strong>
              {{ form.pregnant.label_tag }}<p class="dimmed">{{ form.pregnant.help_text}}</p>
              {{ form.pregnant }}
            </div>
            {% else %}
            <div class="type-select">
              {{ form.pregnant.label_tag }}<p class="dimmed">{{ form.pregnant.help_text}}</p>
              {{ form.pregnant }}
            </div>
            {% endif %}
            {% if form.ring.errors %}
            <div class="type-select error">
              <strong class="message">{{ form.ring.errors }}</strong>
              {{ form.ring.label_tag }}<p class="dimmed">{{ form.ring.help_text}}</p>
              {{ form.ring }}
            </div>
            {% else %}
            <div class="type-select">
              {{ form.ring.label_tag }}<p class="dimmed">{{ form.ring.help_text}}</p>
              {{ form.ring }}
            </div>
            {% endif %}
            {% if form.pregnant_period.errors %}
            <div class="type-text error">
              <strong class="message">{{ form.pregnant_period.errors }}</strong>
              {{ form.pregnant_period.label_tag }}<p class="dimmed">{{ form.pregnant_period.help_text}}</p>
              {{ form.pregnant_period }}
            </div>
            {% else %}
            <div class="type-text">
              {{ form.pregnant_period.label_tag }}<p class="dimmed">{{ form.pregnant_period.help_text}}</p>
              {{ form.pregnant_period }}
            </div>
            {% endif %}

            {% if form.checker.errors %}
            <div class="type-select error">
              <strong class="message">{{ form.checker.errors }}</strong>
              {{ form.checker.label_tag }}<p class="dimmed">{{ form.checker.help_text}}</p>
              {{ form.checker }}
            </div>
            {% else %}
            <div class="type-select">
              {{ form.checker.label_tag }}<p class="dimmed">{{ form.checker.help_text}}</p>
              {{ form.checker }}
            </div>
            {% endif %}

          </fieldset>
          {{ form.id }}
          <div class="center">
            <input type="submit"  name="submit" value="确定" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only  ui-state-"/>
            <input type="reset" value="重置" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only  ui-state-"/>
            <span id="id_submit_error"></span>
          </div>
      </form>
      {% endwith %}

      </div>          
    </div>         
  </div>       
</div>
{% endblock %}

